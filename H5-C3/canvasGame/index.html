<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>game</title>
	<script src="js/jquery-2.1.1.min.js"></script>
	<style>
		* {
			margin: 0;
			padding: 0;
		}

		body, html {
			width: 100%;
			height: 100%;
		}

		canvas {
			position: absolute;
			left: 50%;
			top: 50%;
			transform: translate(-50%, -50%);
		}

		canvas:nth-child(1) {
			background: #00fffd;
		}
	</style>
</head>
<body>
<canvas id="can1" width="500" height="500"></canvas>
<canvas id="can2" width="500" height="500"></canvas>
<script>
	var can1 = document.getElementById("can1");
	var pen1 = can1.getContext("2d");
	var can2 = document.getElementById("can2");
	var pen2 = can2.getContext("2d");

	$(document).mousedown(function () {
		if(canvasGame.pos.arrLine==false){
			var lineLength = 0;
			var flag=true;
			var time = setInterval(function () {
				lineLength += 6;
				canvasGame.gameLine(lineLength);
			}, 20);
		}

			$(document).mouseup(function () {
				clearInterval(time);
				if(flag){
					flag=false;
					var debug = 0;
					var time1 = setInterval(function () {
						debug += 2;
						if(debug<=90){
							var a = debug * Math.PI / 180;
							canvasGame.rotateLine(canvasGame.pos.arrLine[0], a)
						}
						else if (debug-90<=canvasGame.pos.arrLine[0]) {
							canvasGame.gameBox(debug-90);

						}
						else if(debug-canvasGame.pos.arrBg[1]){
							clearInterval(time1)
						}
					}, 20);
				}
			});



	});
//每次小滑块运动结束后  在500的位置  生成一个bg  跟随开始生成的bg一起运动

	var canvasGame = {
		pos: {
			arrBg: [],
//			arrBox: [],
			arrLine: []
		},
		gameBg: function (bgArr) {
			if (!bgArr) {
				for (var i = 0; i < 2; i++) {
					var ran = 150 + Math.floor(Math.random() * 100);
					pen1.beginPath();
					pen1.fillStyle = "#000";
					pen1.rect(i * ran, 350, 80, 150);
					this.pos.arrBg.push(i * ran);
					pen1.fill();
				}
			}

		},
		gameBox: function (arrLine) {
			if (!arrLine) {
				pen1.beginPath();
				pen1.fillStyle = "#FF0D00";
				pen1.rect(0, 300, 50, 50);
				pen1.fill();
			}
			if(arrLine){
				pen1.beginPath();
				pen1.clearRect(0,0,500,350);
				pen1.fillStyle = "#FF0D00";
				pen1.rect(arrLine+20, 300, 50, 50);
				pen1.fill();
			}

		},
		gameLine: function (lineLength) {
			pen1.clearRect(70, 0, 500, 350);
			pen1.beginPath();
			pen1.fillStyle = "#000";
			pen1.rect(70, 350 - lineLength, 8, lineLength);
			this.pos.arrLine[0] = lineLength;
			pen1.fill();
		},
		rotateLine: function (lineLength, a) {
			pen1.save();
			pen1.beginPath();
			pen1.clearRect(70, 0, 500, 350);
			pen1.fillStyle = "#000";
			pen1.translate(70, 350);
			pen1.rotate(a);
			pen1.rect(8, 0, -8, -lineLength);
			pen1.fill();
			pen1.rotate(-a);
			pen1.translate(-70, -350);
			pen1.restore();
		}
	};
	canvasGame.gameBg();
	canvasGame.gameBox();

</script>
</body>
</html>